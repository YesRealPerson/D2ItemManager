let pos1=0,pos2=0,pos3=0,pos4=0,draggable=document.getElementById("itemPanel"),visibility=!0;function hide(e){72===e.keyCode&&document.activeElement!=document.getElementById("searchBox")&&(visibility?(draggable.style.visibility="hidden",visibility=!1):(draggable.style.visibility="visible",visibility=!0)),27===e.keyCode&&deleteWindows(),82===e.keyCode&&(draggable.style.left=0,draggable.style.top="250px")}function dragMouseDown(e){(e=e||window.event).preventDefault(),pos3=e.clientX,pos4=e.clientY,document.onmouseup=closeDragElement,document.onmousemove=elementDrag}function elementDrag(e){(e=e||window.event).preventDefault(),pos1=pos3-e.clientX,pos2=pos4-e.clientY,pos3=e.clientX,pos4=e.clientY;let t=draggable.offsetTop-pos2,n=draggable.offsetLeft-pos1;t>0&&t<window.innerHeight-50&&(draggable.style.top=t+"px",draggable.style.left=n+"px")}function closeDragElement(){document.onmouseup=null,document.onmousemove=null}draggable.onmousedown=dragMouseDown,window.onkeydown=hide;const showItemInfo=async e=>{let t={3:"Common",4:"Rare",5:"Legendary",6:"Exotic"},n={1:"Kinetic",2:"Arc",3:"Solar",4:"Void",5:"",6:"Stasis",7:"Strand"},i={1:"https://www.bungie.net/common/destiny2_content/icons/DestinyDamageTypeDefinition_3385a924fd3ccb92c343ade19f19a370.png",2:"https://www.bungie.net/common/destiny2_content/icons/DestinyDamageTypeDefinition_092d066688b879c807c3b460afdd61e6.png",3:"https://www.bungie.net/common/destiny2_content/icons/DestinyDamageTypeDefinition_2a1773e10968f2d088b97c22b22bba9e.png",4:"https://www.bungie.net/common/destiny2_content/icons/DestinyDamageTypeDefinition_ceb2f6197dccf3958bb31cc783eb97a0.png",5:"https://www.bungie.net/img/misc/missing_icon_d2.png",6:"https://www.bungie.net/common/destiny2_content/icons/DestinyDamageTypeDefinition_530c4c3e7981dc2aefd24fd3293482bf.png",7:"https://www.bungie.net/common/destiny2_content/icons/DestinyDamageTypeDefinition_b2fe51a94f3533f97079dfa0d27a4096.png"},l={47:"Chestplate",49:"Class Item",46:"Gauntlets",45:"Helmet",48:"Legs"};draggable.style.visibility="visible",visibility=!0;let a=e.name,s=t[e.rarity];s||(s="");let r=e.background;r||(r="https://www.bungie.net/img/misc/missing_icon_d2.png");let o=e.stats;o||(o=[]);let c=e.perks;c||(c=[]);let g=e.flavor;g||(g="");let d=1!=e.type[1];document.getElementById("screenshot").setAttribute("src","https://bungie.net"+r),document.getElementById("screenshot").setAttribute("title",a+"<br>"+s),document.getElementById("panelName").innerHTML=a,0!=e.breakerType&&(document.getElementById("panelName").innerHTML+="<br>"+breakerNames[e.breakerType]+'  <img style="width:12px; height: 12px; top:2px; position:relative;" src = "'+breakers[e.breakerType]+'">'),document.getElementById("flavor").innerText=g;let m=document.getElementById("perks");m.innerHTML="";let p=0;c.forEach(e=>{p+=e.length}),c.forEach(e=>{let t=document.createElement("div");t.className="perkColumn";for(let n=0;n<e.length;n++)try{let i=e[n],l=document.createElement("img"),a=20/c.length,s=350/c.length;l.setAttribute("src","https://bungie.net"+i.icon),l.setAttribute("class","perk"),l.setAttribute("title",i.name+"<br>"+i.description.replace(/\n/g,"<br>")),l.style.width="calc("+a+"vw)",l.style.minWidth=s+"px",i.enhanced&&(l.style.border="2px solid #eade8b",l.style.borderRadius="200px",l.style.width="calc(-4px)",l.setAttribute("title","Enhanced "+i.name+"<br>"+i.description.replace(/\n/g,"<br>"))),t.appendChild(l)}catch(r){console.log(r)}m.appendChild(t)});let y=document.getElementById("statName");y.innerHTML="";let b=document.getElementById("valueBar");b.innerHTML="";let h=document.getElementById("statValue");h.innerHTML="";let u=0;y.innerText="",n[e.element]&&(y.innerHTML+="Element:<br>",h.innerHTML+=n[e.element]+' <img src="'+i[e.element]+'" style="width: 12px; height: 12px; vertical-align: middle;"> <br>',u++),""!=e.light&&(y.innerHTML+="Light Level:<br>",h.innerHTML+=e.light+'<img src="/IMG/light.png" style="width: 12px; height: 12px; vertical-align: middle;  transform: scaleX(-1);"><br>',u++),b.style.marginTop=14*u+"px";let $;if(-1!=["Mobility","Resilience","Recovery","Discipline","Intellect","Strength"].indexOf(o[0].name)&&(d=!0),d){let f=s+" "+manifests[4][e.type[0]].shortTitle;l[e.type[1]]&&(f+=" "+l[e.type[1]]),document.getElementById("type").innerHTML=f+"<br>",o.sort((e,t)=>{let n=["Mobility","Resilience","Recovery","Discipline","Intellect","Strength"],i=n.indexOf(e.name),l=n.indexOf(t.name);return(-1==i||-1==l)&&(console.log("UNKNOWN STAT: "+e.name),console.log("UNKNOWN STAT: "+t.name)),i-l})}else{let T=s+" "+manifests[4][e.type[2]].shortTitle;"s"==T[T.length-1]&&(T=T.substring(0,T.length-1)),document.getElementById("type").innerHTML=T+"<br>",o.sort((e,t)=>{let n=["Rounds Per Minute","Draw Time","Charge Time","Magazine","Blast Radius","Velocity","Impact","Range","Stability","Handling","Reload Speed","Shield Duration","Aim Assistance","Airborne Effectiveness","Accuracy","Zoom","Recoil Direction","Swing Speed","Guard Efficiency","Guard Resistance","Charge Rate","Guard Endurance","Ammo Capacity"],i=n.indexOf(e.name),l=n.indexOf(t.name);return(-1==i||-1==l)&&(console.log("UNKNOWN STAT: "+e.name),console.log("UNKNOWN STAT: "+t.name)),i-l})}o.forEach(e=>{let t=e.name,n=e.value,i=e.icon,l=!1;"Aim Assistance"==t?t="AA":"Airborne Effectiveness"==t?t="AE":"Reload Speed"==t?t="Reload":"Recoil Direction"==t?t="Recoil":"Rounds Per Minute"==t&&(t="RPM"),y.innerHTML+=t+":<br>",i?(h.innerHTML+="<img src = https://bungie.net"+i+' style="height: 12px; width: 12px; vertical-align: middle;"> '+n+"<br>",l=!0):h.innerHTML+=n+"<br>";let a=document.createElement("div");a.className="bar",a.title=n;let s=document.createElement("div");colorBars&&(n>45?s.style.backgroundColor="rgb(0,200,0)":n>15?s.style.backgroundColor="rgb(200,200,0)":s.style.backgroundColor="rgb(200,0,0)"),n<0&&(s.style.backgroundColor="rgb(200,0,0)",n*=-1),l&&(n*=2.25),s.className="innerBar",s.style.width=n+"%",("RPM"==t||"Charge Time"==t||"Draw Time"==t||"Magazine"==t)&&(a.style.visibility="hidden"),a.appendChild(s),b.appendChild(a)})};